<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>sim_adpcr. dpcR 0.2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="
Michal Burdukiewicz.
">

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/highlight.css" rel="stylesheet">
<link href="css/staticdocs.css" rel="stylesheet">

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  </head>

  <body>
    <div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="#">dpcR 0.2</a>
      <div class="nav">
        <ul class="nav">
          <li><a href="index.html"><i class="icon-home icon-white"></i> Index</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <div class="container">
      <header>
        
      </header>
      
      <h1>Simulate Array Digital PCR</h1>

<div class="row">
  <div class="span8">
    <h2>Usage</h2>
    <pre><div>sim_adpcr(m, n, times, n_panels&nbsp;=&nbsp;1, dube&nbsp;=&nbsp;FALSE, pos_sums&nbsp;=&nbsp;FALSE)</div></pre>
    
    <h2>Arguments</h2>
    <dl>
      <dt>m</dt>
      <dd>the total number of template molecules added to the plate. Must be
a positive integer.</dd>
      <dt>n</dt>
      <dd>the number of chambers per plate. Must be a positive integer.</dd>
      <dt>times</dt>
      <dd>number of repetitions (see Details).</dd>
      <dt>n_panels</dt>
      <dd>the number of panels that are simulated by the function.
Cannot have higher value than the <code>times</code> argument.</dd>
      <dt>dube</dt>
      <dd>if <code>TRUE</code>, the function is strict implementation of array
digital PCR simulation (as in Dube et al., 2008). If <code>FALSE</code>, the
function calculates only approximation of Dube's experiment. See Details and
References.</dd>
      <dt>pos_sums</dt>
      <dd>if <code>TRUE</code>, function returns only the total number of
positive (containing at least one molecule) chamber per panel. If
<code>FALSE</code>, the functions returns a vector of length equal to the number
of chambers. Each element of the vector represents the number of template
molecules in a given chamber.</dd>
    </dl>
    
    <div class="Value">
      <h2>Value</h2>

      <p><dl>
If the <code>pos_sums</code> argument has value <code>FALSE</code>, the function
returns a matrix with $n$ rows and $n_panels$ columns. Each column
represents one plate. The type of such simulation would be <code>"nm"</code>. If the
<code>pos_sums</code> argument has value <code>TRUE</code>, the function returns a
matrix with one row and $n_panels$ columns. Each column contains the
total number of positive chambers in each plate and type of simulation would
be set as <code>"tnp"</code>.</p>
  
      <p>In each case the value is an object of the <code>adpcr</code> class.
</dl></p>
  
    </div>

    <div class="Description">
      <h2>Description</h2>

      <p>A function that simulates results of an array digital PCR.</p>
  
    </div>

    <div class="Details">
      <h2>Details</h2>

      <p>The array digital PCR is performed on plates containing many microfluidic
chambers with a randomly distributed DNA template, fluorescence labels and
standard PCR reagents. After the amplification reaction, performed
independently in each chamber, the chambers with the fluorescence level
below certain threshold are treated as negative. From differences between
amplification curves of positive chambers it is possible to calculate both
total number of template molecules and their approximate number in a
single chamber.</p>
  
      <p>The function contains two implementations of the array digital PCR
simulation. First one was described in Dube at. al (2008). This method is
based on random distributing $m * times$ molecules
between $n * times$ chambers.  After this step, the
required number of plates is created by the random sampling of chambers
without replacement. The above method is used, when the <code>dube</code> argument
has value <code>TRUE</code>.</p>
  
      <p>The second method treats the total number of template molecules as random
variable with a normal distribution $N(n,
0.05*n)$. The exact sum of total molecules per plate is calculated and
randomly adjusted to the value of $m * times$. The above
method is used, when the <code>dube</code> argument has value <code>FALSE</code>. This
implementation is much faster than previous one, especially for big
simulations. The higher the value of the argument <code>times</code>, the
simulation result is closer to theoretical calculations.</p>
  
    </div>

    <div class="References">
      <h2>References</h2>

      <p>Dube S, Qin J, Ramakrishnan R, <em>Mathematical Analysis of
Copy Number Variation in a DNA Sample Using Digital PCR on a Nanofluidic
Device</em>.  PLoS ONE 3(8), 2008.</p>
  
    </div>
    
    <h2 id="examples">Examples</h2>
    <pre class="examples"><div class='input'># Simulation of a digital PCR experiment with a chamber based technology.
# The parameter pos_sums was altered to change how the total number of positive
# chamber per panel are returned. An alteration of the parameter has an impact
# in the system performance.
adpcr_big &lt;- sim_adpcr(m = 10, n = 40, times = 1000, pos_sums = FALSE, n_panels = 1000)
adpcr_small &lt;- sim_adpcr(m = 10, n = 40, times = 1000, pos_sums = TRUE, n_panels = 1000)
# with pos_sums = TRUE, output allocates less memory
object.size(adpcr_big)
</div>
<div class='output'>520480 bytes
</div>
<div class='input'>object.size(adpcr_small)
</div>
<div class='output'>211584 bytes
</div>
<div class='input'>
# Mini version of Dube et al. 2008 experiment, full requires replic &lt;- 70000
# The number of replicates was reduced by a factor of 100 to lower the computation time.
replic &lt;- 700
dube &lt;- sim_adpcr(400, 765, times = replic, dube = TRUE,
    pos_sums = TRUE, n_panels = replic)
mean(dube) # 311.5616
</div>
<div class='output'>[1] 311.1971
</div>
<div class='input'>sd(dube) # 13.64159
</div>
<div class='output'>[1] 14.11301
</div>
<div class='input'>
# Create a barplot from the simulated data similar to Dube et al. 2008
bp &lt;- barplot(table(factor(dube, levels = min(dube):max(dube))),
	      space = 0)
</div>
<div class='input'>lines(bp, dnorm(min(dube):max(dube), mean = 311.5, sd = 13.59)*replic,
      col = &quot;green&quot;, lwd = 3)
</div>
<p><img src='sim_adpcr-11.png' alt='' width='540' height='400' /></p>
<div class='input'>
# Exact Dube&#39;s method is a bit slower than other one, but more accurate
system.time(dub &lt;- sim_adpcr(m = 400, n = 765, times = 500, n_panels = 500,
  pos_sums = TRUE))
</div>
<div class='output'>   user  system elapsed 
   0.45    0.00    0.50 
</div>
<div class='input'>system.time(mul &lt;- sim_adpcr(m = 400, n = 765, times = 500, n_panels = 500,
  pos_sums = FALSE))
</div>
<div class='output'>   user  system elapsed 
   0.44    0.00    0.45 
</div></pre>
  </div>
  <div class="span4">
    <!-- <ul>
      <li>sim_adpcr</li>
    </ul>
    <ul>
      <li>datagen</li>
    </ul> -->
      
    <h2>See also</h2>
    
<code><a href='sim_ddpcr.html'>sim_ddpcr</a></code>.

    
    <h2>Author</h2>
    
Michal Burdukiewicz.

    
  </div>
</div>
      
      <footer>
      <p class="pull-right"><a href="#">Back to top</a></p>
<p>Built by <a href="https://github.com/hadley/staticdocs">staticdocs</a>. Styled with <a href="http://twitter.github.com/bootstrap">bootstrap</a>.</p>
      </footer>
    </div>
  </body>
</html>